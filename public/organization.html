<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Информация об организации - Place&Play</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.0/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="/js/eventFilters.js"></script>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .organization-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .tab-container {
            display: flex;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            transition: background 0.3s;
        }

        .tab.active {
            background: white;
            border-bottom: none;
            font-weight: bold;
        }

        .tab:hover {
            background: #e2e6ea;
        }

        .org-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(to right, #f8f9fa, #ffffff);
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .org-title {
            color: #113366;
            font-size: 2.2em;
            margin: 0 0 10px 0;
            background: linear-gradient(45deg, #113366, #4a90e2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .org-address {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 1.1em;
        }

        .org-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .status-PENDING { background: #fff3cd; color: #856404; }
        .status-ACTIVE { background: #d4edda; color: #155724; }
        .status-BLOCKED { background: #f8d7da; color: #721c24; }

        .org-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .info-card h3 {
            margin: 0 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
            color: #113366;
            font-size: 1.3em;
            position: relative;
        }

        .info-card h3::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 50px;
            height: 2px;
            background: linear-gradient(to right, #4a90e2, #113366);
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 10px;
        }

        .schedule-day {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .schedule-day:hover {
            transform: translateY(-3px);
        }

        .schedule-day.working {
            background: linear-gradient(45deg, #d4edda, #c3e6cb);
        }

        .schedule-day.non-working {
            background: linear-gradient(45deg, #f8d7da, #f5c6cb);
        }

        .working-hours {
            color: #155724;
            font-weight: 500;
        }

        .non-working-day {
            color: #721c24;
            font-weight: 500;
        }

        .info-card p {
            margin: 8px 0;
            line-height: 1.6;
        }

        .info-card strong {
            color: #495057;
        }

        .status-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }

        .badge {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .badge:hover {
            transform: translateY(-2px);
        }

        .badge.standard {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
        }

        .badge.premium {
            background: linear-gradient(45deg, #fff3cd, #ffeeba);
        }

        .badge.luxury {
            background: linear-gradient(45deg, #e9d8fd, #d6bcfa);
        }

        .account-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .account-field {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .account-field:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .field-icon {
            font-size: 1.5em;
        }

        .field-content {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .field-value {
            font-weight: 500;
            color: #212529;
        }

        .verification-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .verification-status.verified {
            background: linear-gradient(45deg, #d4edda, #c3e6cb);
            color: #155724;
        }

        .verification-status.unverified {
            background: linear-gradient(45deg, #f8d7da, #f5c6cb);
            color: #721c24;
        }

        .rating {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: linear-gradient(45deg, #fff3cd, #ffeeba);
            border-radius: 20px;
            color: #856404;
        }

        .dates {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
            color: #6c757d;
            font-size: 0.9em;
        }

        .card-icon {
            font-size: 1.5em;
        }

        .price-slot {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: grid;
            grid-template-columns: 1fr 1fr 2fr;
            gap: 20px;
            align-items: center;
            transition: transform 0.2s;
        }

        .price-slot:hover {
            transform: scale(1.02);
        }

        .time-range {
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            color: #495057;
            text-align: center;
        }

        .price-value {
            background: #d4edda;
            padding: 8px 15px;
            border-radius: 20px;
            color: #155724;
            font-weight: 600;
            text-align: center;
        }

        .price-icon {
            font-size: 1.5em;
        }

        .desc-icon {
            font-size: 1.5em;
        }

        .day-icon {
            font-size: 1.5em;
        }

        .facilities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            padding: 10px;
        }

        .facility-item {
            background: white;
            padding: 12px 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .facility-item:hover {
            transform: translateY(-2px);
        }

        .facility-item.active {
            background: linear-gradient(45deg, #d4edda, #c3e6cb);
            color: #155724;
        }

        .facility-item.inactive {
            background: linear-gradient(45deg, #f8d7da, #f5c6cb);
            color: #721c24;
        }

        .facility-icon {
            font-size: 1.5em;
        }

        .facility-name {
            font-weight: 500;
        }

        .facility-status {
            font-weight: 500;
        }

        .events-container {
            margin-top: 30px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 25px;
        }

        .events-container h2 {
            color: #113366;
            font-size: 24px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .events-container h2::before {
            content: '📅';
            font-size: 1.2em;
        }

        .event-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
            margin-bottom: 20px;
            transition: all 0.3s ease;
            border: 1px solid #f0f0f0;
            position: relative;
            overflow: hidden;
        }

        .event-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .event-item h3 {
            color: #113366;
            font-size: 1.3em;
            margin: 0 0 15px 0;
            padding-right: 120px;
        }

        .event-status {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .event-item p {
            margin: 8px 0;
            color: #495057;
            line-height: 1.5;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .event-item p strong {
            color: #6c757d;
            min-width: 120px;
        }

        .event-item .price {
            font-weight: 600;
            color: #28a745;
            font-size: 1.1em;
        }

        .event-item .organizer {
            color: #6c757d;
            font-style: italic;
        }

        .event-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .event-item button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .event-item button:first-child {
            background-color: #28a745;
            color: white;
        }

        .event-item button:last-child {
            background-color: #007bff;
            color: white;
        }

        .event-item button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .event-item button:first-child:hover {
            background-color: #218838;
        }

        .event-item button:last-child:hover {
            background-color: #0056b3;
        }

        #eventsPagination {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #f0f0f0;
        }

        .pagination-info {
            text-align: center;
            color: #6c757d;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .pagination-controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .pagination-button {
            padding: 8px 16px;
            border: 1px solid #dee2e6;
            background-color: white;
            color: #495057;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 40px;
            text-align: center;
        }

        .pagination-button:hover:not(:disabled) {
            background-color: #f8f9fa;
            border-color: #ced4da;
        }

        .pagination-button.active {
            background-color: #113366;
            color: white;
            border-color: #113366;
        }

        .pagination-button:disabled {
            background-color: #f8f9fa;
            color: #adb5bd;
            cursor: not-allowed;
        }

        #lastUpdateInfo {
            text-align: right;
            color: #6c757d;
            font-size: 0.85em;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 6px;
        }

        .auto-refresh-status {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #6c757d;
            font-size: 0.9em;
        }

        .auto-refresh-active {
            width: 8px;
            height: 8px;
            background-color: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .refresh-button {
            padding: 8px 16px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .refresh-button:hover {
            background-color: #218838;
            transform: translateY(-1px);
        }

        .refresh-button::before {
            content: '🔄';
        }

        .no-events-message {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
            font-size: 1.1em;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 20px 0;
        }

        .no-events-message::before {
            content: '📅';
            font-size: 2em;
            display: block;
            margin-bottom: 10px;
        }

        /* Обновленные стили для статусов событий */
        .event-status.status-PENDING_APPROVAL {
            background: linear-gradient(45deg, #ffc107, #ffb300);
            color: #000;
        }

        .event-status.status-CHANGES_REQUESTED {
            background: linear-gradient(45deg, #fd7e14, #fb8c00);
            color: #fff;
        }

        .event-status.status-REJECTED {
            background: linear-gradient(45deg, #dc3545, #d32f2f);
            color: #fff;
        }

        .event-status.status-CONFIRMED {
            background: linear-gradient(45deg, #28a745, #2e7d32);
            color: #fff;
        }

        .event-status.status-IN_PROGRESS {
            background: linear-gradient(45deg, #17a2b8, #0288d1);
            color: #fff;
        }

        .event-status.status-COMPLETED {
            background: linear-gradient(45deg, #6c757d, #546e7a);
            color: #fff;
        }

        .event-status.status-CANCELLED {
            background: linear-gradient(45deg, #dc3545, #c62828);
            color: #fff;
        }

        .event-status.status-EXPIRED {
            background: linear-gradient(45deg, #6c757d, #455a64);
            color: #fff;
        }

        .event-status.status-OPEN {
            background: linear-gradient(45deg, #28a745, #43a047);
            color: #fff;
        }

        /* Анимация для новых событий */
        @keyframes highlightNew {
            0% {
                transform: translateX(-100%);
                background-color: rgba(40, 167, 69, 0.1);
            }
            50% {
                transform: translateX(0);
                background-color: rgba(40, 167, 69, 0.1);
            }
            100% {
                transform: translateX(0);
                background-color: white;
            }
        }

        .event-item.new-event {
            animation: highlightNew 1.5s ease-out;
        }

        /* Стили для индикатора обновления */
        .update-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .update-indicator .refresh-button {
            margin-right: auto;
        }

        .update-indicator .auto-refresh-status {
            margin-left: auto;
        }

        /* Адаптивные стили */
        @media (max-width: 768px) {
            .events-container {
                padding: 15px;
            }

            .event-item {
                padding: 15px;
            }

            .event-item h3 {
                padding-right: 0;
                font-size: 1.1em;
            }

            .event-status {
                position: static;
                display: inline-block;
                margin-bottom: 10px;
            }

            .event-item p {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .event-item p strong {
                min-width: auto;
            }

            .event-actions {
                flex-direction: column;
            }

            .event-item button {
                width: 100%;
                justify-content: center;
            }

            .pagination-controls {
                gap: 4px;
            }

            .pagination-button {
                padding: 6px 12px;
                min-width: 35px;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease-out, fadeOut 0.3s ease-out 2.7s;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }

        .connection-status.connected {
            background-color: #d4edda;
            color: #155724;
        }

        .connection-status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }

        @keyframes highlightNew {
            0% {
                transform: translateX(-100%);
                background-color: rgba(40, 167, 69, 0.2);
            }
            50% {
                transform: translateX(0);
                background-color: rgba(40, 167, 69, 0.2);
            }
            100% {
                transform: translateX(0);
                background-color: white;
            }
        }

        .event-item.new-event {
            animation: highlightNew 1.5s ease-out;
        }

        .notification-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInNotification 0.5s ease-out, fadeOutNotification 0.5s ease-out 4.5s;
            pointer-events: none;
        }

        @keyframes slideInNotification {
            from {
                transform: translateX(120%) translateY(-50%);
                opacity: 0;
            }
            to {
                transform: translateX(0) translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeOutNotification {
            from {
                opacity: 1;
                transform: translateX(0) translateY(0);
            }
            to {
                opacity: 0;
                transform: translateX(20px) translateY(0);
            }
        }

        .notification-badge::before {
            content: '🔔';
            font-size: 1.2em;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            background-color: #28a745;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.5;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .context-menu {
            position: fixed;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            padding: 8px 0;
            min-width: 200px;
            z-index: 1000;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.1s, transform 0.1s;
            visibility: hidden;
        }

        .context-menu.active {
            opacity: 1;
            transform: scale(1);
            visibility: visible;
        }

        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #333;
            transition: background-color 0.2s;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item.danger {
            color: #dc3545;
        }

        .context-menu-item.success {
            color: #28a745;
        }

        .context-menu-separator {
            height: 1px;
            background-color: #dee2e6;
            margin: 4px 0;
        }

        .context-menu-icon {
            font-size: 1.1em;
            width: 20px;
            text-align: center;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalAppear 0.3s ease-out;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 5px;
            line-height: 1;
        }

        .modal-close:hover {
            color: #333;
        }

        .event-details {
            padding: 20px;
        }

        .event-details-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .event-details-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }

        .event-details-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .participants-list {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .participant-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .participant-item:last-child {
            border-bottom: none;
        }

        .participant-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #6c757d;
        }

        .participant-info {
            flex-grow: 1;
        }

        .participant-name {
            font-weight: 500;
            color: #333;
        }

        .participant-joined {
            font-size: 0.9em;
            color: #6c757d;
        }

        .participant-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            background: #e9ecef;
            color: #495057;
        }

        .filters-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-group {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            color: #495057;
            font-weight: 500;
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 14px;
        }

        .filter-group input[type="number"] {
            width: calc(50% - 5px);
        }

        .price-range {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 10px;
            border-top: 1px solid #dee2e6;
        }

        .filter-button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .apply-filters {
            background-color: #28a745;
            color: white;
        }

        .apply-filters:hover {
            background-color: #218838;
        }

        .reset-filters {
            background-color: #6c757d;
            color: white;
        }

        .reset-filters:hover {
            background-color: #5a6268;
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .filter-tag {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            background: #e9ecef;
            border-radius: 15px;
            font-size: 0.9em;
            color: #495057;
        }

        .filter-tag button {
            border: none;
            background: none;
            color: #dc3545;
            cursor: pointer;
            padding: 0 3px;
            font-size: 1.1em;
            line-height: 1;
        }

        .filter-tag button:hover {
            color: #c82333;
        }

        .event-status.status-PENDING_APPROVAL {
            background-color: #ffc107;
            color: #000;
        }
        .event-status.status-CHANGES_REQUESTED {
            background-color: #fd7e14;
            color: #fff;
        }
        .event-status.status-REJECTED {
            background-color: #dc3545;
            color: #fff;
        }
        .event-status.status-CONFIRMED {
            background-color: #28a745;
            color: #fff;
        }
        .event-status.status-IN_PROGRESS {
            background-color: #17a2b8;
            color: #fff;
        }
        .event-status.status-COMPLETED {
            background-color: #6c757d;
            color: #fff;
        }
        .event-status.status-CANCELLED {
            background-color: #dc3545;
            color: #fff;
        }
        .event-status.status-EXPIRED {
            background-color: #6c757d;
            color: #fff;
        }
        .event-status.status-OPEN {
            background-color: #28a745;
            color: #fff;
        }

        .event-item.status-PENDING_APPROVAL {
            border-left-color: #ffc107;
            background: linear-gradient(to right, rgba(255, 193, 7, 0.05), white);
        }
        .event-item.status-CHANGES_REQUESTED {
            border-left-color: #fd7e14;
            background: linear-gradient(to right, rgba(253, 126, 20, 0.05), white);
        }
        .event-item.status-REJECTED {
            border-left-color: #dc3545;
            background: linear-gradient(to right, rgba(220, 53, 69, 0.05), white);
        }
        .event-item.status-CONFIRMED {
            border-left-color: #28a745;
            background: linear-gradient(to right, rgba(40, 167, 69, 0.05), white);
        }
        .event-item.status-IN_PROGRESS {
            border-left-color: #17a2b8;
            background: linear-gradient(to right, rgba(23, 162, 184, 0.05), white);
        }
        .event-item.status-COMPLETED {
            border-left-color: #6c757d;
            background: linear-gradient(to right, rgba(108, 117, 125, 0.05), white);
        }
        .event-item.status-CANCELLED {
            border-left-color: #dc3545;
            background: linear-gradient(to right, rgba(220, 53, 69, 0.05), white);
        }
        .event-item.status-EXPIRED {
            border-left-color: #6c757d;
            background: linear-gradient(to right, rgba(108, 117, 125, 0.05), white);
        }
        .event-item.status-OPEN {
            border-left-color: #28a745;
            background: linear-gradient(to right, rgba(40, 167, 69, 0.05), white);
        }

        .email-form {
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #495057;
        }
        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-control:focus {
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .status-change-menu {
            position: absolute;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: none;
        }
        .status-change-menu.active {
            display: block;
        }
        .status-change-item {
            padding: 8px 16px;
            cursor: pointer;
            white-space: nowrap;
        }
        .status-change-item:hover {
            background-color: #f8f9fa;
        }

        .event-details-status:hover {
            opacity: 0.8; /* Added hover effect */
        }

        .status-dropdown-icon {
            margin-left: 5px; /* Space between text and icon */
            font-size: 0.8em; /* Slightly smaller than text */
            color: rgba(255, 255, 255, 0.9); /* Same color as meta info */
            vertical-align: middle; /* Align vertically */
        }

        /* Existing status colors from organization.html */
        .event-details-status.status-PENDING_APPROVAL { background-color: #ffc107; color: #000; }
        .event-details-status.status-CHANGES_REQUESTED { background-color: #fd7e14; color: #fff; }
        .event-details-status.status-REJECTED { background-color: #dc3545; color: #fff; }
        .event-details-status.status-CONFIRMED { background-color: #28a745; color: #fff; }
        .event-details-status.status-IN_PROGRESS { background-color: #17a2b8; color: #fff; }
        .event-details-status.status-COMPLETED { background-color: #6c757d; color: #fff; }
        .event-details-status.status-CANCELLED { background-color: #dc3545; color: #fff; }
        .event-details-status.status-EXPIRED { background-color: #6c757d; color: #fff; }
        .event-details-status.status-OPEN { background-color: #28a745; color: #fff; }

        .ws-status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: normal;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .ws-status-indicator.connected {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .ws-status-indicator.disconnected {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .ws-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6c757d;
            transition: background-color 0.3s ease;
        }

        .ws-status-indicator.connected .ws-status-dot {
            background: #28a745;
            animation: pulse 2s infinite;
        }

        .ws-status-indicator.disconnected .ws-status-dot {
            background: #dc3545;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.5;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="organization-container">
        <div class="tab-container">
            <div class="tab active" onclick="showOrgInfo()">Информация об организации</div>
            <div class="tab" onclick="showEvents()">События</div>
            <button onclick="logout()" style="margin-left: auto; padding: 8px 12px; border: none; border-radius: 5px; background-color: #dc3545; color: white; cursor: pointer;">Выйти</button>
        </div>
        <div id="orgInfo"></div>
        <div id="eventsSection" class="events-container" style="display: none;">
            <h2>
                События
                <span id="wsStatusIndicator" class="ws-status-indicator" title="Статус подключения">
                    <span class="ws-status-dot"></span>
                    <span class="ws-status-text">Подключение...</span>
                </span>
            </h2>
            <div id="autoRefreshIndicator"></div>
            <div id="eventsList"></div>
            <div id="eventsPagination"></div>
        </div>
    </div>

    <script>
        // Сохраняем orgId глобально
        let currentOrgId = null;
        let currentPage = 0;
        const pageSize = 5;
        let autoRefreshInterval;
        let lastEventCount = 0;
        let lastUpdateTime = 0;
        let stompClient = null;
        let wsConnected = false;
        let currentSubscription;

        let currentFilters = {
            dateFrom: '',
            dateTo: '',
            status: '',
            eventType: '',
            priceMin: '',
            priceMax: '',
            availableSpots: '',
            searchQuery: ''
        };

        // Добавляем глобальные переменные для хранения текущих данных
        let currentEventData = null;
        let currentOrganizerData = null;

        function displayOrgInfo(data) {
            const org = data.organization;
            currentOrgId = org.orgId;
            localStorage.setItem('orgId', org.orgId);
            console.log("Got orgId "+org.orgId);

            const orgInfoDiv = document.getElementById('orgInfo');
            
            const content = `
                <div class="org-header">
                    <div>
                        <h1 class="org-title">${org.attributes.name.ru}</h1>
                        <p class="org-address">${org.address}</p>
                    </div>
                    <span class="org-status status-${org.status}">${getStatusText(org.status)}</span>
                </div>

                <div class="org-info-grid">
                    <div class="info-card">
                        <h3>Основная информация</h3>
                        <p><strong>Тип организации:</strong> ${org.orgType}</p>
                        <p><strong>Рейтинг:</strong> <span class="rating">${org.rating} ⭐</span></p>
                        
                        <div class="status-badges">
                            <div class="badge ${org.priceCategory.toLowerCase()}">
                                <span class="badge-icon">💎</span>
                                <span class="badge-text">${getPriceCategoryText(org.priceCategory)}</span>
                            </div>
                            <div class="badge ${org.verificationStatus.toLowerCase()}">
                                <span class="badge-icon">${org.verificationStatus === 'VERIFIED' ? '✓' : '!'}</span>
                                <span class="badge-text">${getVerificationStatusText(org.verificationStatus)}</span>
                            </div>
                        </div>
                        
                        <div class="dates">
                            <p><strong>Дата создания:</strong> ${formatDate(org.createdAt)}</p>
                            <p><strong>Последнее обновление:</strong> ${formatDate(org.updatedAt)}</p>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3>Информация об аккаунте</h3>
                        <div class="account-info">
                            <div class="account-field">
                                <span class="field-icon">📧</span>
                                <div class="field-content">
                                    <span class="field-value">${data.account.email}</span>
                                    <span class="verification-status ${data.account.emailVerified ? 'verified' : 'unverified'}">
                                        ${data.account.emailVerified ? 'Подтвержден' : 'Не подтвержден'}
                                    </span>
                                </div>
                            </div>
                            <div class="account-field">
                                <span class="field-icon">📱</span>
                                <div class="field-content">
                                    <span class="field-value">${data.account.phone}</span>
                                    <span class="verification-status ${data.account.phoneVerified ? 'verified' : 'unverified'}">
                                        ${data.account.phoneVerified ? 'Подтвержден' : 'Не подтвержден'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    ${renderAttributes(org.attributes.attributes)}
                </div>`;

            orgInfoDiv.innerHTML = content;
        }

        function renderAttributes(attributes) {
            let html = '';

            for (const [key, attr] of Object.entries(attributes)) {
                switch(attr.input) {
                    case 'boolean':
                        html += `
                            <div class="info-card">
                                <h3>${attr.name.ru}</h3>
                                <p>${attr.value ? 'Да' : 'Нет'}</p>
                            </div>`;
                        break;

                    case 'json':
                        if (key === 'openHours') {
                            html += renderSchedule(attr);
                        }
                        break;

                    case 'int':
                    case 'decimal':
                        html += `
                            <div class="info-card">
                                <h3>${attr.name.ru}</h3>
                                <p>${attr.value}</p>
                            </div>`;
                        break;

                    case 'select':
                        html += `
                            <div class="info-card">
                                <h3>${attr.name.ru}</h3>
                                <p>${attr.value}</p>
                            </div>`;
                        break;

                    case 'multiselect':
                        html += renderMultiselect(attr);
                        break;

                    case 'boolean_group':
                        html += renderFacilities(attr);
                        break;

                    case 'dynamic_time_price':
                        html += renderPricing(attr);
                        break;
                }
            }

            return html;
        }

        function renderPricing(attr) {
            let html = `
                <div class="info-card">
                    <h3>
                        <span class="card-icon">💰</span>
                        ${attr.name.ru}
                    </h3>
                    <div class="price-schedule">`;
            
            attr.value.forEach(timeSlot => {
                html += `
                    <div class="price-slot">
                        <div class="time-range">
                            <span class="time-icon">🕒</span>
                            ${timeSlot.timeRange.start} - ${timeSlot.timeRange.end}
                        </div>
                        <div class="price-value">
                            <span class="price-icon">💵</span>
                            ${formatPrice(timeSlot.price)} сум
                        </div>
                        <div class="price-description">
                            <span class="desc-icon">📝</span>
                            ${timeSlot.description.ru}
                        </div>
                    </div>`;
            });

            html += `</div></div>`;
            return html;
        }

        function renderSchedule(attr) {
            const schedule = attr.value.schedule;
            const days = {
                monday: { name: 'Понедельник', icon: '1️⃣' },
                tuesday: { name: 'Вторник', icon: '2️⃣' },
                wednesday: { name: 'Среда', icon: '3️⃣' },
                thursday: { name: 'Четверг', icon: '4️⃣' },
                friday: { name: 'Пятница', icon: '5️⃣' },
                saturday: { name: 'Суббота', icon: '6️⃣' },
                sunday: { name: 'Воскресенье', icon: '7️⃣' }
            };

            let html = `
                <div class="info-card">
                    <h3>
                        <span class="card-icon">📅</span>
                        ${attr.name.ru}
                    </h3>
                    <div class="schedule-grid">`;

            for (const [day, hours] of Object.entries(schedule)) {
                html += `
                    <div class="schedule-day ${hours.isWorking ? 'working' : 'non-working'}">
                        <div class="day-icon">${days[day].icon}</div>
                        <strong>${days[day].name}</strong>
                        ${hours.isWorking ? 
                            `<div class="working-hours">
                                <span class="time-icon">🕒</span>
                                ${hours.start} - ${hours.end}
                            </div>` : 
                            '<div class="non-working-day">Выходной</div>'}
                    </div>`;
            }

            html += `</div></div>`;
            return html;
        }

        function renderMultiselect(attr) {
            const selectedValues = attr.value.map(id => {
                const option = attr.options.find(opt => opt.id === id);
                return option ? option.name.ru : '';
            }).filter(Boolean);

            return `
                <div class="info-card">
                    <h3>${attr.name.ru}</h3>
                    <p>${selectedValues.join(', ')}</p>
                </div>`;
        }

        function renderFacilities(attr) {
            const facilityIcons = {
                racketRental: '🎾',
                ballAvailability: '⚾',
                changingRooms: '🚪',
                showerAvailable: '🚿',
                parkingAvailability: '🅿️',
                wifiAvailable: '📶',
                cafeAvailable: '☕',
                coachAvailable: '👨‍🏫',
                lightingAvailable: '💡',
                equipmentAvailable: '🎽',
                stringingService: '🔧'
            };

            const facilityNames = {
                racketRental: 'Аренда ракеток',
                ballAvailability: 'Мячи',
                changingRooms: 'Раздевалки',
                showerAvailable: 'Душевые',
                parkingAvailability: 'Парковка',
                wifiAvailable: 'Wi-Fi',
                cafeAvailable: 'Кафе',
                coachAvailable: 'Тренер',
                lightingAvailable: 'Освещение',
                equipmentAvailable: 'Экипировка',
                stringingService: 'Натяжка ракеток'
            };

            let html = `
                <div class="info-card">
                    <h3>
                        <span class="card-icon">🏢</span>
                        ${attr.name.ru}
                    </h3>
                    <div class="facilities-grid">`;

            for (const [facility, value] of Object.entries(attr.value)) {
                html += `
                    <div class="facility-item ${value ? 'active' : 'inactive'}">
                        <span class="facility-icon">${facilityIcons[facility] || '🔹'}</span>
                        <span class="facility-name">${facilityNames[facility] || facility}</span>
                        <span class="facility-status">${value ? '✅' : '❌'}</span>
                    </div>`;
            }

            html += `</div></div>`;
            return html;
        }

        function getStatusText(status) {
            console.log('getStatusText called with status:', status);
            const statuses = {
                'PENDING_APPROVAL': 'Ожидает подтверждения',
                'CHANGES_REQUESTED': 'Требуются изменения',
                'REJECTED': 'Отклонено',
                'CONFIRMED': 'Подтверждено',
                'IN_PROGRESS': 'В процессе',
                'COMPLETED': 'Завершено',
                'CANCELLED': 'Отменено',
                'EXPIRED': 'Просрочено',
                'OPEN': 'Открыто'
            };
            return statuses[status] || status;
        }

        function getPriceCategoryText(category) {
            const categories = {
                'STANDARD': 'Стандарт',
                'PREMIUM': 'Премиум',
                'LUXURY': 'Люкс'
            };
            return categories[category] || category;
        }

        function getVerificationStatusText(status) {
            const statuses = {
                'UNVERIFIED': 'Не верифицирован',
                'VERIFIED': 'Верифицирован'
            };
            return statuses[status] || status;
        }

        function formatDate(dateString) {
            if (!dateString) return 'Нет данных';
            const date = new Date(dateString);
            return date.toLocaleString('ru-RU', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('ru-RU').format(price);
        }

        document.addEventListener('DOMContentLoaded', loadOrgInfo);

        async function loadOrgInfo() {
            try {
                // Проверяем токены перед загрузкой
                const tokensValid = await validateAndRefreshTokens();
                if (!tokensValid) {
                    console.log('Токены невалидны, отмена загрузки информации');
                    return;
                }

                const accessToken = localStorage.getItem('accessToken');
                const refreshToken = localStorage.getItem('refreshToken');

                console.log('Отправляем запрос orgInfo с заголовками:', {
                    'Content-Type': 'application/json',
                    'User-Agent': 'insomnia/10.3.1',
                    'language': 'ru',
                    'accessToken': accessToken,
                    'refreshToken': refreshToken
                });

                const response = await fetch('/PlaceAndPlay/api/auth/organizations/orgInfo', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': 'insomnia/10.3.1',
                        'language': 'ru',
                        'accessToken': accessToken,
                        'refreshToken': refreshToken
                    },
                    credentials: 'include'
                });

                console.log('Ответ от orgInfo:', {
                    status: response.status,
                    headers: Object.fromEntries(response.headers.entries())
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('Полученные данные:', data);
                    displayOrgInfo(data);
                } else {
                    console.error('Ошибка запроса:', response.status);
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.error('Ошибка при загрузке информации:', error);
                alert('Ошибка при загрузке информации об организации');
            }
        }

        function showEvents() {
            document.getElementById('orgInfo').style.display = 'none';
            document.getElementById('eventsSection').style.display = 'block';
            document.querySelector('.tab.active').classList.remove('active');
            document.querySelector('.tab:nth-child(2)').classList.add('active');

            // Инициализируем фильтры при первом показе вкладки событий
            if (!eventFilters) {
                eventFilters = new EventFilters();
            }

            loadEvents(currentPage);
            
            if (!wsConnected) {
                connectWebSocket();
            }
        }

        async function loadEvents(page = 0, silent = false) {
            try {
                console.log('Загрузка событий, страница:', page);
                
                // Проверяем токены перед загрузкой
                const tokensValid = await validateAndRefreshTokens();
                if (!tokensValid) {
                    console.log('Токены невалидны, отмена загрузки событий');
                    return false;
                }

                const accessToken = localStorage.getItem('accessToken');
                const refreshToken = localStorage.getItem('refreshToken');
                const language = 'ru';
                
                // Using the new static URL provided by the user
                const eventsUrl = '/PlaceAndPlay/api/v1/events/organization/11/events?statuses=CONFIRMED,PENDING_APPROVAL&sort=date_time,desc';

                console.log('Отправляем запрос на получение событий:', eventsUrl);

                const response = await fetch(eventsUrl, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'accessToken': accessToken,
                        'refreshToken': refreshToken,
                        'language': language,
                        'Cache-Control': 'no-cache'
                    },
                    credentials: 'include'
                });

                if (!response.ok) {
                    throw new Error(`Ошибка сети: ${response.status}`);
                }

                const data = await response.json();
                console.log('Получены события:', data);
                
                const currentEventCount = data.content.length;
                const hasChanges = currentEventCount !== lastEventCount || 
                                 JSON.stringify(data.content) !== localStorage.getItem('lastEventsData');

                if (hasChanges || !silent) {
                    console.log('Обновляем отображение событий');
                    displayEvents(data.content);
                    // Note: Pagination controls will likely not work as expected with this static URL
                    // because the URL does not support pagination parameters.
                    updatePaginationControls(data.totalPages, data.totalElements);
                    lastEventCount = currentEventCount;
                    localStorage.setItem('lastEventsData', JSON.stringify(data.content));
                    localStorage.setItem('lastTotalPages', data.totalPages.toString());
                    
                    lastUpdateTime = Date.now();
                    updateLastUpdateTime();
                }

                return hasChanges;
            } catch (error) {
                console.error('Ошибка при загрузке событий:', error);
                if (!silent) {
                    showNotification('Ошибка при загрузке событий', 'error');
                }
                return false;
            }
        }

        function displayEvents(events) {
            const eventsList = document.getElementById('eventsList');
            const lastUpdateInfo = document.getElementById('lastUpdateInfo');
            
            if (!eventsList) {
                console.error('Element eventsList not found');
                return;
            }

            const previousEvents = new Set(Array.from(eventsList.children)
                .map(el => el.dataset.eventId));

            eventsList.innerHTML = '';

            if (events.length === 0) {
                eventsList.innerHTML = `
                    <div class="no-events-message">
                        Нет событий для отображения
                    </div>`;
            } else {
                events.forEach(event => {
                    const eventItem = document.createElement('div');
                    eventItem.className = `event-item status-${event.status}`;
                    eventItem.dataset.eventId = event.eventId;
                    eventItem.dataset.status = event.status;
                    eventItem.dataset.eventData = JSON.stringify(event);

                    if (!previousEvents.has(event.eventId.toString())) {
                        eventItem.classList.add('new-event');
                    }

                    const eventDate = new Date(event.dateTime[0], event.dateTime[1] - 1, event.dateTime[2], 
                                             event.dateTime[3], event.dateTime[4]);

                    eventItem.innerHTML = `
                        <div class="event-status status-${event.status}">
                            <i class="status-icon">${getStatusIcon(event.status)}</i>
                            ${getStatusText(event.status)}
                        </div>
                        <h3>${event.title}</h3>
                        <p>
                            <strong>📝 Описание:</strong>
                            <span>${event.description}</span>
                        </p>
                        <p>
                            <strong>🏷️ Тип события:</strong>
                            <span>${event.eventType}</span>
                        </p>
                        <p>
                            <strong>📅 Дата:</strong>
                            <span>${eventDate.toLocaleString('ru-RU')}</span>
                        </p>
                        <p>
                            <strong>📍 Место:</strong>
                            <span>${event.location}</span>
                        </p>
                        <p class="organizer">
                            <strong>👤 Организатор:</strong>
                            <span>${event.organizer.name} (${event.organizer.email})</span>
                        </p>
                        <p class="price">
                            <strong>💰 Цена:</strong>
                            <span>${formatPrice(event.price)} сум</span>
                        </p>
                        <p>
                            <strong>👥 Участники:</strong>
                            <span>${event.participantsCount} из ${event.maxParticipants}</span>
                        </p>
                    `;

                    eventItem.addEventListener('contextmenu', showContextMenu);
                    eventsList.appendChild(eventItem);
                });
            }

            if (lastUpdateInfo) {
                lastUpdateInfo.innerHTML = `
                    <i class="update-icon">🕒</i>
                    Обновлено: ${new Date().toLocaleTimeString('ru-RU')}
                `;
            }
        }

        function getStatusIcon(status) {
            const icons = {
                'PENDING_APPROVAL': '⏳',
                'CHANGES_REQUESTED': '🔄',
                'REJECTED': '❌',
                'CONFIRMED': '✅',
                'IN_PROGRESS': '🚀',
                'COMPLETED': '🏁',
                'CANCELLED': '🚫',
                'EXPIRED': '⏰',
                'OPEN': '🔓'
            };
            return icons[status] || '📌';
        }

        // Создаем и добавляем контекстное меню в DOM
        const contextMenu = document.createElement('div');
        contextMenu.className = 'context-menu';
        document.body.appendChild(contextMenu);

        // Обработчик контекстного меню
        function showContextMenu(e) {
            e.preventDefault();
            const eventItem = e.currentTarget;
            
            try {
                // Получаем данные о событии и организаторе
                currentEventData = JSON.parse(eventItem.dataset.eventData);
                currentOrganizerData = {
                    userId: currentEventData.organizer.organizerId,
                    email: currentEventData.organizer.email,
                    phoneNumber: currentEventData.organizer.phoneNumber
                };

                console.log('Текущие данные:', {
                    event: currentEventData,
                    organizer: currentOrganizerData
                });

                // Получаем размеры окна и прокрутки
                const windowHeight = window.innerHeight;
                const windowWidth = window.innerWidth;

                // Позиционируем меню сначала у курсора
                contextMenu.style.visibility = 'hidden';
                contextMenu.style.display = 'block';
                
                // Генерируем содержимое меню только с нужными опциями
                let menuContent = `
                    <div class="context-menu-item" onclick="viewEventDetails(${currentEventData.eventId})">
                        <span class="context-menu-icon">📋</span>
                        Просмотреть детали
                    </div>
                    <div class="context-menu-separator"></div>
                    <div class="context-menu-item" onclick="showEmailModal()">
                        <span class="context-menu-icon">📧</span>
                        Написать на почту
                    </div>
                    <div class="context-menu-item" onclick="showPhoneNumber()">
                        <span class="context-menu-icon">📱</span>
                        Позвонить
                    </div>
                `;

                contextMenu.innerHTML = menuContent;

                // Получаем размеры меню после добавления содержимого
                const menuRect = contextMenu.getBoundingClientRect();
                
                // Вычисляем координаты с учетом прокрутки и размеров окна
                let x = e.clientX;
                let y = e.clientY;

                // Проверяем, выходит ли меню за пределы окна справа
                if (x + menuRect.width > windowWidth) {
                    x = windowWidth - menuRect.width - 10;
                }

                // Проверяем, выходит ли меню за пределы окна снизу
                if (y + menuRect.height > windowHeight) {
                    y = windowHeight - menuRect.height - 10;
                }

                // Устанавливаем позицию меню
                contextMenu.style.left = `${x}px`;
                contextMenu.style.top = `${y}px`;

                // Показываем меню
                contextMenu.style.visibility = 'visible';
                contextMenu.classList.add('active');

                // Закрываем меню при клике вне его
                const closeMenu = (e) => {
                    if (!contextMenu.contains(e.target)) {
                        contextMenu.classList.remove('active');
                        setTimeout(() => {
                            contextMenu.style.display = 'none';
                        }, 150);
                        document.removeEventListener('click', closeMenu);
                        document.removeEventListener('contextmenu', closeMenu);
                        document.removeEventListener('scroll', closeMenu);
                    }
                };
                
                // Добавляем слушатели для закрытия
                setTimeout(() => {
                    document.addEventListener('click', closeMenu);
                    document.addEventListener('contextmenu', closeMenu);
                    document.addEventListener('scroll', closeMenu);
                }, 0);
            } catch (error) {
                console.error('Ошибка при обработке контекстного меню:', error);
                showNotification('Ошибка при открытии меню', 'error');
            }
        }

        // Обработчик прокрутки для закрытия контекстного меню
        window.addEventListener('scroll', () => {
            const menu = document.querySelector('.context-menu');
            if (menu && menu.classList.contains('active')) {
                menu.classList.remove('active');
                setTimeout(() => {
                    menu.style.display = 'none';
                }, 150);
            }
        });

        // Функции для обработки действий контекстного меню
        async function viewEventDetails(eventId) {
            try {
                const accessToken = localStorage.getItem('accessToken');
                const refreshToken = localStorage.getItem('refreshToken');
                
                const response = await fetch(`/PlaceAndPlay/api/v1/events/${eventId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'accessToken': accessToken,
                        'refreshToken': refreshToken,
                        'language': 'ru'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Ошибка при загрузке деталей события: ${response.status}`);
                }

                const eventData = await response.json();
                showEventDetailsModal(eventData);
            } catch (error) {
                console.error('Ошибка при загрузке деталей события:', error);
                showNotification('Ошибка при загрузке деталей события');
            }
        }

        function showEventDetailsModal(event) {
            let modalOverlay = document.querySelector('.modal-overlay');
            if (!modalOverlay) {
                modalOverlay = document.createElement('div');
                modalOverlay.className = 'modal-overlay';
                document.body.appendChild(modalOverlay);
            }

            // Сохраняем данные текущего события и организатора для использования в меню
            currentEventData = event;
            currentOrganizerData = event.organizer;

            const eventDate = new Date(event.dateTime[0], event.dateTime[1] - 1, event.dateTime[2], 
                                     event.dateTime[3], event.dateTime[4]);

            const participantsHtml = event.participants.map(participant => {
                const joinedDate = new Date(participant.joinedAt[0], participant.joinedAt[1] - 1, 
                                          participant.joinedAt[2], participant.joinedAt[3], 
                                          participant.joinedAt[4], participant.joinedAt[5]);
                
                return `
                    <div class="participant-item">
                        <div class="participant-avatar">
                            ${participant.profilePictureUrl ? 
                                `<img src="${participant.profilePictureUrl}" alt="${participant.participantName}" 
                                      style="width: 40px; height: 40px; object-fit: cover; border-radius: 50%;">` :
                                `<div class="avatar-placeholder">${participant.participantName.charAt(0)}</div>`}
                        </div>
                        <div class="participant-info">
                            <div class="participant-name">${participant.participantName}</div>
                            <div class="participant-joined">
                                <i class="join-icon">🕒</i>
                                Присоединился: ${joinedDate.toLocaleString('ru-RU')}
                            </div>
                        </div>
                        <span class="participant-status status-${participant.status.toLowerCase()}">
                            ${getParticipantStatusText(participant.status)}
                        </span>
                    </div>
                `;
            }).join('');

            modalOverlay.innerHTML = `
                <div class="modal-content event-details-modal">
                    <div class="modal-header">
                        <div class="event-header-main">
                            <h2 class="event-details-title">${event.title}</h2>
                            <div class="event-actions">
                                <!-- Кнопка ⋮ удалена -->
                                <button class="modal-close" onclick="closeEventDetailsModal()">&times;</button>
                            </div>
                        </div>
                         <span class="event-details-status status-${event.status}" id="modalStatusBadge"> <!-- Добавлен ID и класс курсора -->
                            ${getStatusText(event.status)}
                            <i class="status-dropdown-icon">▼</i> <!-- Added dropdown icon -->
                        </span>
                        <div class="event-header-meta">
                            <div class="event-date">
                                <i class="event-icon">📅</i>
                                ${eventDate.toLocaleString('ru-RU', {
                                    weekday: 'long',
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                })}
                            </div>
                            <div class="event-location">
                                <i class="event-icon">📍</i>
                                ${event.location}
                            </div>
                        </div>
                    </div>

                    <div class="modal-body">
                        <div class="event-content-grid">
                            <div class="event-main-info">
                                <div class="info-section">
                                    <h3 class="section-title">
                                        <i class="section-icon">📝</i>
                                        Описание
                                    </h3>
                                    <p class="event-description">${event.description}</p>
                                </div>

                                <div class="info-section">
                                    <h3 class="section-title">
                                        <i class="section-icon">ℹ️</i>
                                        Детали события
                                    </h3>
                                    <div class="event-details-grid">
                                        <div class="detail-item">
                                            <span class="detail-label">Тип события</span>
                                            <span class="detail-value">${event.eventType}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Цена</span>
                                            <span class="detail-value price">${formatPrice(event.price)} сум</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Участники</span>
                                            <span class="detail-value participants">
                                                ${event.participantsCount} из ${event.maxParticipants}
                                                <div class="progress-bar">
                                                    <div class="progress" style="width: ${(event.participantsCount / event.maxParticipants) * 100}%"></div>
                                                </div>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="organizer-info">
                                <h3 class="section-title">
                                    <i class="section-icon">👤</i>
                                    Организатор
                                </h3>
                                <div class="organizer-card">
                                    <div class="organizer-avatar">
                                        ${event.organizer.profilePictureUrl ? 
                                            `<img src="${event.organizer.profilePictureUrl}" alt="${event.organizer.name}" 
                                                  style="width: 80px; height: 80px; object-fit: cover; border-radius: 50%;">` :
                                            `<div class="avatar-placeholder large">${event.organizer.name.charAt(0)}</div>`}
                                    </div>
                                    <div class="organizer-details">
                                        <div class="organizer-name">${event.organizer.name}</div>
                                        <div class="organizer-rating">
                                            <span class="rating-value">${event.organizer.rating}</span>
                                            <span class="rating-stars">${'⭐'.repeat(Math.round(event.organizer.rating))}</span>
                                        </div>
                                        <div class="organizer-type">
                                            <i class="type-icon">🏢</i>
                                            ${getOrganizationTypeText(event.organizer.organizationType)}
                                        </div>
                                        <div class="organizer-contact">
                                            <button class="contact-button" onclick="contactOrganizer(${event.eventId})">
                                                <i class="contact-icon">📞</i>
                                                Связаться с организатором
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="participants-section">
                                <h3 class="section-title">
                                    <i class="section-icon">👥</i>
                                    Участники
                                    <span class="participants-count">${event.participants.length}</span>
                                </h3>
                                <div class="participants-list">
                                    ${participantsHtml || '<p class="no-participants">Нет участников</p>'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Добавляем стили для улучшенного UI/UX с прокруткой и курсором для статуса
            const style = document.createElement('style');
            style.textContent = `
                .event-details-modal {
                    max-width: 900px;
                    max-height: 90vh;
                    display: flex;
                    flex-direction: column;
                    background: white;
                    border-radius: 12px;
                    overflow: hidden;
                    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
                }

                .modal-header {
                    background: linear-gradient(135deg, #113366 0%, #4a90e2 100%);
                    color: white;
                    padding: 30px;
                    flex-shrink: 0;
                    position: sticky;
                    top: 0;
                    z-index: 10;
                }

                .modal-body {
                    flex-grow: 1;
                    overflow-y: auto;
                    padding: 30px;
                    background: #f8f9fa;
                    scrollbar-width: thin;
                    scrollbar-color: #113366 #f8f9fa;
                }

                .modal-body::-webkit-scrollbar {
                    width: 8px;
                }

                .modal-body::-webkit-scrollbar-track {
                    background: #f8f9fa;
                }

                .modal-body::-webkit-scrollbar-thumb {
                    background-color: #113366;
                    border-radius: 4px;
                    border: 2px solid #f8f9fa;
                }

                .event-header-main {
                    display: flex;
                    justify-content: space-between;
                    align-items: flex-start;
                    margin-bottom: 10px;
                }

                .event-details-title {
                    font-size: 28px;
                    font-weight: 700;
                    color: white;
                    margin: 0;
                }

                .event-actions {
                    display: flex;
                    gap: 10px;
                    align-items: center;
                }

                .event-details-status {
                     display: inline-block;
                     padding: 5px 12px;
                     border-radius: 15px;
                     font-size: 14px;
                     font-weight: 500;
                     margin-bottom: 15px;
                     cursor: pointer; /* Added cursor pointer */
                     transition: opacity 0.2s; /* Added transition for hover */
                }

                .event-details-status:hover {
                    opacity: 0.8; /* Added hover effect */
                }

                /* Existing status colors from organization.html */
                .event-details-status.status-PENDING_APPROVAL { background-color: #ffc107; color: #000; }
                .event-details-status.status-CHANGES_REQUESTED { background-color: #fd7e14; color: #fff; }
                .event-details-status.status-REJECTED { background-color: #dc3545; color: #fff; }
                .event-details-status.status-CONFIRMED { background-color: #28a745; color: #fff; }
                .event-details-status.status-IN_PROGRESS { background-color: #17a2b8; color: #fff; }
                .event-details-status.status-COMPLETED { background-color: #6c757d; color: #fff; }
                .event-details-status.status-CANCELLED { background-color: #dc3545; color: #fff; }
                .event-details-status.status-EXPIRED { background-color: #6c757d; color: #fff; }
                .event-details-status.status-OPEN { background-color: #28a745; color: #fff; }


                .event-header-meta {
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                }

                .event-date,
                .event-location {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    font-size: 1em;
                    color: rgba(255, 255, 255, 0.9);
                }

                .event-icon {
                    font-size: 1.1em;
                    color: rgba(255, 255, 255, 0.7);
                }

                .event-content-grid {
                    display: grid;
                    grid-template-columns: 1fr;
                    gap: 30px;
                    max-width: 800px;
                    margin: 0 auto;
                }

                @media (min-width: 768px) {
                    .event-content-grid {
                        grid-template-columns: 2fr 1fr;
                    }
                    
                    .participants-section {
                        grid-column: 1 / -1;
                    }
                }

                .info-section {
                    background: white;
                    padding: 20px;
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                    margin-bottom: 20px;
                }

                .section-title {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    color: #113366;
                    margin-bottom: 15px;
                    font-size: 1.2em;
                }

                .event-description {
                    line-height: 1.6;
                    color: #495057;
                }

                .event-details-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 15px;
                }

                .detail-item {
                    display: flex;
                    flex-direction: column;
                    gap: 5px;
}

                .detail-label {
                    color: #6c757d;
                    font-size: 0.9em;
                }

                .detail-value {
                    font-weight: 500;
                    color: #212529;
                }

                .detail-value.price {
                    color: #28a745;
                }

                .progress-bar {
                    height: 6px;
                    background: #e9ecef;
                    border-radius: 3px;
                    overflow: hidden;
                    margin-top: 5px;
                }

                .progress {
                    height: 100%;
                    background: linear-gradient(90deg, #28a745, #20c997);
                    transition: width 0.3s ease;
                }

                .organizer-card {
                    background: white;
                    padding: 20px;
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                }

                .organizer-avatar {
                    width: 80px;
                    height: 80px;
                    border-radius: 50%;
                    overflow: hidden;
                    margin-bottom: 15px;
                }

                .avatar-placeholder {
                    width: 100%;
                    height: 100%;
                    background: #e9ecef;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 2em;
                    color: #6c757d;
                }

                .organizer-name {
                    font-size: 1.2em;
                    font-weight: 600;
                    color: #113366;
                    margin-bottom: 10px;
                }

                .organizer-rating {
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    margin-bottom: 10px;
                }

                .rating-value {
                    font-weight: 600;
                    color: #ffc107;
                }

                .organizer-type {
                    color: #6c757d;
                    margin-bottom: 15px;
                }

                .participants-list {
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                    overflow: hidden;
                }

                .participant-item {
                    display: flex;
                    align-items: center;
                    padding: 15px;
                    border-bottom: 1px solid #e9ecef;
                    transition: background-color 0.2s;
                }

                .participant-item:hover {
                    background-color: #f8f9fa;
                }

                .participant-item:last-child {
                    border-bottom: none;
                }

                .participants-count {
                    background: #113366;
                    color: white;
                    padding: 2px 8px;
                    border-radius: 12px;
                    font-size: 0.9em;
                    margin-left: 10px;
                }

                .no-participants {
                    text-align: center;
                    color: #6c757d;
                    padding: 20px;
                }

                .contact-button {
                    width: 100%;
                    padding: 12px;
                    background: #113366;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 8px;
                    transition: background-color 0.2s;
                }

                .contact-button:hover {
                    background: #1a4b8c;
                }

                .action-button {
                    background: rgba(255, 255, 255, 0.2);
                    border: none;
                    color: white;
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    transition: background-color 0.2s;
                }

                .action-button:hover {
                    background: rgba(255, 255, 255, 0.3);
                }

                .modal-close {
                    background: rgba(255, 255, 255, 0.2);
                    border: none;
                    color: white;
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    cursor: pointer;
                    transition: background-color 0.2s;
                }

                .modal-close:hover {
                    background: rgba(255, 255, 255, 0.3);
                }

                .status-change-dropdown {
                     position: absolute;
                     background: white;
                     border-radius: 8px;
                     box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
                     padding: 8px 0;
                     min-width: 200px;
                     z-index: 1001; /* Higher z-index than modal body */
                     display: none; /* Hidden by default */
                }

                .status-change-dropdown.active {
                     display: block;
                }

                .status-change-dropdown-item {
                     padding: 10px 16px;
                     cursor: pointer;
                     transition: background-color 0.2s;
                     color: #495057;
                     display: flex; /* Use flexbox for icon and text */
                     align-items: center;
                     gap: 8px;
                }

                .status-change-dropdown-item:hover {
                     background-color: #f8f9fa;
                     color: #113366;
                }

                .status-change-dropdown-item.danger {
                     color: #dc3545;
                }

                .status-change-dropdown-item.danger:hover {
                     background-color: #fff5f5;
                }

                .status-change-dropdown-separator {
                     height: 1px;
                     background-color: #dee2e6;
                     margin: 4px 0;
                }

                @media (max-width: 768px) {
                    .event-details-modal {
                        width: 95%;
                        max-height: 95vh;
                    }

                    .modal-header {
                        padding: 20px;
                    }

                    .modal-body {
                        padding: 20px;
                    }

                    .event-content-grid {
                        gap: 20px;
                    }

                    .organizer-card {
                        padding: 15px;
                    }
                }
            `;
            document.head.appendChild(style);

            modalOverlay.style.display = 'flex';

            // Добавляем обработчик клика на статус-бейдж
            const statusBadge = modalOverlay.querySelector('#modalStatusBadge');
            if (statusBadge) {
                statusBadge.addEventListener('click', function(e) {
                    e.stopPropagation(); // Предотвращаем всплытие события
                    showStatusChangeDropdown(event, this);
                });
            }


            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    closeEventDetailsModal();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeEventDetailsModal();
                }
            });

            // Закрываем меню смены статуса при клике вне его
            document.addEventListener('click', function(e) {
                const dropdown = document.querySelector('.status-change-dropdown');
                if (dropdown && !dropdown.contains(e.target) && !statusBadge.contains(e.target)) {
                    dropdown.remove();
                }
            });
        }

        function showContactOptions(event) {
            return event.organizer.phoneNumber;
        }

        function showEventContextMenu(event, button) {
            const rect = button.getBoundingClientRect();
            
            // Удаляем существующее меню, если оно есть
            const existingMenu = document.querySelector('.event-context-menu');
            if (existingMenu) {
                existingMenu.remove();
            }

            const menu = document.createElement('div');
            menu.className = 'event-context-menu';
            
            let menuItems = '';
            
            // Добавляем пункты меню в зависимости от текущего статуса
            switch(event.status) {
                case 'PENDING_APPROVAL':
                    menuItems = `
                        <div class="context-menu-item" onclick="changeEventStatus('${event.eventId}', 'CONFIRMED')">
                            <i>✅</i>
                            Подтвердить
                        </div>
                        <div class="context-menu-item" onclick="changeEventStatus('${event.eventId}', 'CHANGES_REQUESTED')">
                            <i>🔄</i>
                            Требуются изменения
                        </div>
                        <div class="context-menu-separator"></div>
                        <div class="context-menu-item danger" onclick="changeEventStatus('${event.eventId}', 'REJECTED')">
                            <i>❌</i>
                            Отклонить
                        </div>
                    `;
                    break;
                case 'CONFIRMED':
                    // Нет действий по смене статуса для этого состояния по требованию пользователя
                    menuItems = '';
                    break;
                case 'IN_PROGRESS':
                    menuItems = `
                        <div class="context-menu-item" onclick="changeEventStatus('${event.eventId}', 'COMPLETED')">
                            <i>✅</i>
                            Завершить
                        </div>
                    `;
                    break;
                default:
                    // Действие по умолчанию: копировать информацию
                    menuItems = `
                        <div class="context-menu-item" onclick="copyEventInfo('${event.eventId}')">
                            <i>📋</i>
                            Копировать информацию
                        </div>
                    `;
            }

            // Удалена проверка if (!menuItems.trim()) { return; }

            menu.innerHTML = menuItems;

            // Позиционируем меню
            menu.style.top = `${rect.bottom + 5}px`;
            menu.style.right = `${window.innerWidth - rect.right}px`;

            document.body.appendChild(menu);

            // Закрываем меню при клике вне его
            const closeMenu = (e) => {
                if (!menu.contains(e.target) && e.target !== button) {
                    menu.remove();
                    document.removeEventListener('click', closeMenu);
                }
            };

            setTimeout(() => {
                document.addEventListener('click', closeMenu);
            }, 0);
        }

        async function changeEventStatus(newStatus) {
            if (!currentEventData) {
                showNotification('Данные о событии недоступны', 'error');
                return;
            }

            try {
                const accessToken = localStorage.getItem('accessToken');
                const refreshToken = localStorage.getItem('refreshToken');
                const eventId = currentEventData.eventId;
                const organizerId = currentEventData.organizer.organizerId;

                if (!organizerId) {
                    throw new Error('ID организатора не найден');
                }

                console.log('Отправка запроса на смену статуса:', {
                    eventId,
                    organizerId,
                    newStatus,
                    method: 'PUT'
                });

                const response = await fetch(`/PlaceAndPlay/api/v1/events/${eventId}/status?userId=${organizerId}&action=${newStatus}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'accessToken': accessToken,
                        'refreshToken': refreshToken
                    }
                });

                if (response.ok) {
                    showNotification(`Статус события изменен на: ${getStatusText(newStatus)}`, 'success');
                    closeEventDetailsModal();
                    loadEvents(currentPage, false);
                } else {
                    const errorData = await response.json().catch(() => null);
                    throw new Error(errorData?.message || 'Ошибка при изменении статуса');
                }
            } catch (error) {
                console.error('Ошибка при изменении статуса:', error);
                showNotification(error.message || 'Ошибка при изменении статуса события', 'error');
            }
        }

        function getParticipantStatusText(status) {
            const statuses = {
                'CONFIRMED': 'Подтвержден',
                'PENDING': 'Ожидает',
                'CANCELLED': 'Отменен'
            };
            return statuses[status] || status;
        }

        function getOrganizationTypeText(type) {
            const types = {
                'INDIVIDUAL': 'Частное лицо',
                'ORGANIZATION': 'Организация',
                'COMPANY': 'Компания'
            };
            return types[type] || type;
        }

        function closeEventDetailsModal() {
            const modalOverlay = document.querySelector('.modal-overlay');
            if (modalOverlay) {
                modalOverlay.style.display = 'none';
            }
        }

        function copyEventInfo(eventId) {
            const eventItem = document.querySelector(`[data-event-id="${eventId}"]`);
            const eventData = JSON.parse(eventItem.dataset.eventData);
            const info = `
Событие: ${eventData.title}
Описание: ${eventData.description}
Дата: ${new Date(eventData.dateTime).toLocaleString('ru-RU')}
Организатор: ${eventData.organizer.name}
Email: ${eventData.organizer.email}
Цена: ${formatPrice(eventData.price)} сум
Статус: ${getStatusText(eventData.status)}
            `.trim();

            navigator.clipboard.writeText(info).then(() => {
                showNotification('Информация о событии скопирована в буфер обмена');
            });
        }

        function cancelEvent(eventId) {
            if (confirm('Вы уверены, что хотите отменить это событие?')) {
                // Здесь добавить API-запрос на отмену события
                console.log('Отмена события:', eventId);
                showNotification('Событие отменено');
            }
        }

        function reopenEvent(eventId) {
            if (confirm('Вы хотите возобновить это событие?')) {
                // Здесь добавить API-запрос на возобновление события
                console.log('Возобновление события:', eventId);
                showNotification('Событие возобновлено');
            }
        }

        function deleteEvent(eventId) {
            if (confirm('Вы уверены, что хотите удалить это событие? Это действие нельзя отменить.')) {
                // Здесь добавить API-запрос на удаление события
                console.log('Удаление события:', eventId);
                showNotification('Событие удалено');
            }
        }

        function showOrgInfo() {
            document.getElementById('orgInfo').style.display = 'block';
            document.getElementById('eventsSection').style.display = 'none';
            document.querySelector('.tab.active').classList.remove('active');
            document.querySelector('.tab:nth-child(1)').classList.add('active');
            
            // Отключаем WebSocket при переходе на вкладку информации
            if (stompClient) {
                stompClient.disconnect();
                wsConnected = false;
                updateConnectionStatus(false);
            }
        }

        function logout() {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            window.location.href = '/login.html';
        }

        function updatePaginationControls(totalPages, totalElements) {
            const paginationContainer = document.getElementById('eventsPagination');
            if (!paginationContainer) return;

            paginationContainer.innerHTML = '';

            // Добавляем информацию об общем количестве событий
            const totalInfo = document.createElement('div');
            totalInfo.className = 'pagination-info';
            totalInfo.style.marginBottom = '10px';
            totalInfo.textContent = `Всего событий: ${totalElements}`;
            paginationContainer.appendChild(totalInfo);

            // Если страниц меньше или равно 1, не показываем пагинацию
            if (totalPages <= 1) {
                return;
            }

            const paginationControls = document.createElement('div');
            paginationControls.className = 'pagination-controls';
            paginationControls.style.display = 'flex';
            paginationControls.style.justifyContent = 'center';
            paginationControls.style.gap = '5px';

            // Кнопка "Предыдущая"
            const prevButton = document.createElement('button');
            prevButton.textContent = 'Предыдущая';
            prevButton.className = 'pagination-button';
            prevButton.disabled = currentPage === 0;
            prevButton.onclick = () => {
                if (currentPage > 0) {
                    currentPage--;
                    loadEvents(currentPage);
                }
            };
            paginationControls.appendChild(prevButton);

            // Номера страниц
            for (let i = 0; i < totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i + 1;
                pageButton.className = `pagination-button ${i === currentPage ? 'active' : ''}`;
                pageButton.onclick = () => {
                    currentPage = i;
                    loadEvents(currentPage);
                };
                paginationControls.appendChild(pageButton);
            }

            // Кнопка "Следующая"
            const nextButton = document.createElement('button');
            nextButton.textContent = 'Следующая';
            nextButton.className = 'pagination-button';
            nextButton.disabled = currentPage === totalPages - 1;
            nextButton.onclick = () => {
                if (currentPage < totalPages - 1) {
                    currentPage++;
                    loadEvents(currentPage);
                }
            };
            paginationControls.appendChild(nextButton);

            paginationContainer.appendChild(paginationControls);
        }

        function updateLastUpdateTime() {
            const lastUpdateInfo = document.getElementById('lastUpdateInfo');
            if (lastUpdateInfo) {
                const timeAgo = Math.floor((Date.now() - lastUpdateTime) / 1000);
                let timeString;
                
                if (timeAgo < 60) {
                    timeString = 'только что';
                } else if (timeAgo < 3600) {
                    timeString = `${Math.floor(timeAgo / 60)} мин. назад`;
                } else {
                    timeString = new Date(lastUpdateTime).toLocaleTimeString('ru-RU');
                }
                
                lastUpdateInfo.textContent = `Обновлено: ${timeString}`;
            }
        }

        // Добавляем функцию для проверки и обновления токенов
        async function validateAndRefreshTokens() {
            try {
                const accessToken = localStorage.getItem('accessToken');
                const refreshToken = localStorage.getItem('refreshToken');

                if (!accessToken || !refreshToken) {
                    console.log('Токены отсутствуют, перенаправление на логин');
                    window.location.href = '/login.html';
                    return false;
                }

                console.log('Проверяем токены через validateToken...');
                const response = await fetch('/PlaceAndPlay/api/auth/organizations/validateToken', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'accessToken': accessToken,
                        'refreshToken': refreshToken
                    }
                });

                if (!response.ok) {
                    console.error('Ошибка при проверке токенов:', response.status);
                    window.location.href = '/login.html';
                    return false;
                }

                const data = await response.json();
                console.log('Ответ от validateToken:', data);

                if (data.status === 200 && data.tokenInfo) {
                    // Обновляем токены в localStorage
                    localStorage.setItem('accessToken', data.tokenInfo.accessToken);
                    localStorage.setItem('refreshToken', data.tokenInfo.refreshToken);
                    
                    if (data.result === "Tokens refreshed successfully") {
                        console.log('Токены успешно обновлены');
                    } else {
                        console.log('Токены валидны');
                    }
                    return true;
                }

                console.error('Неожиданный ответ от validateToken:', data);
                return false;
            } catch (error) {
                console.error('Ошибка при проверке токенов:', error);
                return false;
            }
        }

        // Обновляем функцию connectWebSocket
        async function connectWebSocket() {
            console.log('Начинаем подключение к WebSocket...');
            
            if (stompClient && stompClient.connected) {
                console.log('WebSocket уже подключен');
                updateConnectionStatus(true);
                return;
            }

            // Проверяем и обновляем токены перед подключением
            const tokensValid = await validateAndRefreshTokens();
            if (!tokensValid) {
                console.log('Токены невалидны, отмена подключения к WebSocket');
                return;
            }

            const accessToken = localStorage.getItem('accessToken');
            console.log('Токен доступа получен');

            try {
                console.log('Создаем SockJS соединение...');
                // Используем относительный URL, который автоматически подхватит текущий протокол (http/https)
                const socket = new SockJS('/PlaceAndPlay/ws');
                
                console.log('Создаем STOMP клиент...');
                stompClient = Stomp.over(socket);
                
                // Включаем отладочные сообщения для диагностики
                stompClient.debug = function(str) {
                    console.log('STOMP Debug:', str);
                };

                console.log('Подключаемся к STOMP с заголовком авторизации...');
                stompClient.connect(
                    {
                        'Authorization': `Bearer ${accessToken}`,
                        'accept-version': '1.1,1.0',
                        'heart-beat': '10000,10000'
                    },
                    function(frame) {
                        console.log('Успешно подключено к STOMP:', frame);
                        updateConnectionStatus(true);
                        
                        const orgId = localStorage.getItem('orgId');
                        console.log('Получен orgId:', orgId);
                        
                        if (orgId) {
                            // Подписываемся на события
                            const eventsTopic = `/topic/events/${orgId}`;
                            console.log('Подписываемся на топик событий:', eventsTopic);
                            
                            stompClient.subscribe(eventsTopic, function(message) {
                                console.log('Получено сообщение о событии:', message);
                                try {
                                    const event = JSON.parse(message.body);
                                    console.log('Распарсено событие:', event);
                                    
                                    // Обновляем UI в зависимости от типа события
                                    switch(event.type) {
                                        case 'EVENT_CREATED':
                                            console.log('Обработка EVENT_CREATED:', event.data);
                                            showNotification('Создано новое событие: ' + event.data.name, 'success');
                                            loadEvents(currentPage, false);
                                            break;
                                        case 'EVENT_UPDATED':
                                            console.log('Обработка EVENT_UPDATED:', event.data);
                                            showNotification('Событие обновлено: ' + event.data.name, 'info');
                                            loadEvents(currentPage, false);
                                            break;
                                        case 'EVENT_DELETED':
                                            console.log('Обработка EVENT_DELETED:', event.data);
                                            showNotification('Событие удалено', 'warning');
                                            loadEvents(currentPage, false);
                                            break;
                                        case 'EVENT_PUBLISHED':
                                            console.log('Обработка EVENT_PUBLISHED:', event.data);
                                            showNotification('Событие опубликовано: ' + event.data.name, 'success');
                                            loadEvents(currentPage, false);
                                            break;
                                        case 'EVENT_UNPUBLISHED':
                                            console.log('Обработка EVENT_UNPUBLISHED:', event.data);
                                            showNotification('Событие снято с публикации: ' + event.data.name, 'warning');
                                            loadEvents(currentPage, false);
                                            break;
                                        default:
                                            console.log('Неизвестный тип события:', event.type, event);
                                    }
                                } catch (error) {
                                    console.error('Ошибка при обработке сообщения о событии:', error);
                                    console.error('Содержимое сообщения:', message.body);
                                    showNotification('Ошибка при обработке сообщения', 'error');
                                }
                            });

                            // Подписываемся на обновления места
                            const placeTopic = `/topic/place/${orgId}`;
                            console.log('Подписываемся на топик места:', placeTopic);
                            
                            stompClient.subscribe(placeTopic, function(message) {
                                console.log('Получено сообщение о месте:', message);
                                try {
                                    const update = JSON.parse(message.body);
                                    console.log('Распарсено обновление места:', update);
                                    
                                    // Если пришло простое сообщение "update"
                                    if (update === 'update') {
                                        console.log('Получено обновление места');
                                        showNotification('Информация о месте и событиях обновлена', 'info');
                                        loadOrgInfo();
                                        loadEvents(currentPage, false);
                                        return;
                                    }
                                    
                                    // Обработка типизированных обновлений
                                    switch(update.type) {
                                        case 'PLACE_UPDATED':
                                            console.log('Обработка PLACE_UPDATED:', update.data);
                                            showNotification('Информация о месте обновлена', 'info');
                                            loadOrgInfo();
                                            break;
                                        case 'PLACE_STATUS_CHANGED':
                                            console.log('Обработка PLACE_STATUS_CHANGED:', update.data);
                                            showNotification(`Статус места изменен на: ${update.data.status}`, 'info');
                                            loadOrgInfo();
                                            break;
                                        case 'PLACE_VERIFICATION_CHANGED':
                                            console.log('Обработка PLACE_VERIFICATION_CHANGED:', update.data);
                                            showNotification(`Статус верификации изменен на: ${update.data.verificationStatus}`, 'info');
                                            loadOrgInfo();
                                            break;
                                        default:
                                            console.log('Неизвестный тип обновления места:', update);
                                            loadOrgInfo();
                                    }
                                } catch (error) {
                                    console.error('Ошибка при обработке сообщения о месте:', error);
                                    console.error('Содержимое сообщения:', message.body);
                                    showNotification('Ошибка при обработке обновления места', 'error');
                                }
                            });

                            console.log('Подписки успешно созданы');
                        } else {
                            console.error('orgId не найден в localStorage');
                        }
                    },
                    function(error) {
                        console.error('Ошибка подключения к STOMP:', error);
                        updateConnectionStatus(false, error);
                        try {
                            showNotification('Ошибка подключения к серверу', 'error');
                        } catch (e) {
                            console.error('Не удалось показать уведомление:', e);
                        }
                        console.log('Попытка переподключения через 5 секунд...');
                        setTimeout(connectWebSocket, 5000);
                    }
                );
                console.log('Запрос на подключение к STOMP отправлен');
            } catch (error) {
                console.error('Ошибка при создании WebSocket:', error);
                updateConnectionStatus(false, error);
                try {
                    showNotification('Ошибка при создании WebSocket соединения', 'error');
                } catch (e) {
                    console.error('Не удалось показать уведомление:', e);
                }
            }
        }

        // Добавляем вызов connectWebSocket при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Страница загружена, инициализируем WebSocket...');
            connectWebSocket();
        });

        function updateConnectionStatus(connected, error = null) {
            const statusIndicator = document.getElementById('wsStatusIndicator');
            if (!statusIndicator) {
                console.error('WebSocket status indicator not found');
                return;
            }

            if (connected) {
                statusIndicator.className = 'ws-status-indicator connected';
                statusIndicator.querySelector('.ws-status-text').textContent = 'Подключено';
                wsConnected = true;
            } else {
                statusIndicator.className = 'ws-status-indicator disconnected';
                statusIndicator.querySelector('.ws-status-text').textContent = error ? 
                    `Ошибка: ${error.message}` : 'Отключено';
                wsConnected = false;
            }
        }

        // Обработка видимости страницы
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && !wsConnected && document.getElementById('eventsSection').style.display !== 'none') {
                console.log('Page became visible, reconnecting WebSocket...');
                connectWebSocket();
            }
        });

        // Очистка при уходе со страницы
        window.addEventListener('beforeunload', () => {
            if (stompClient) {
                stompClient.disconnect();
                wsConnected = false;
            }
        });

        // Обновляем HTML структуру для индикатора
        const autoRefreshIndicator = document.createElement('div');
        autoRefreshIndicator.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                <div style="display: flex; align-items: center;">
                    <button onclick="loadEvents()" style="padding: 8px 12px; border: none; border-radius: 5px; background-color: #28a745; color: white; cursor: pointer;">
                        Обновить сейчас
                    </button>
                    <span style="margin-left: 10px;" class="auto-refresh-status">
                        Подключение...
                    </span>
                </div>
                <div id="lastUpdateInfo"></div>
            </div>
        `;

        // Функция для отображения уведомлений
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            // Добавляем стили для уведомлений
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = '4px';
            notification.style.zIndex = '1000';
            notification.style.animation = 'slideIn 0.5s ease-out';
            
            // Стили в зависимости от типа уведомления
            switch(type) {
                case 'success':
                    notification.style.backgroundColor = '#4CAF50';
                    notification.style.color = 'white';
                    break;
                case 'error':
                    notification.style.backgroundColor = '#f44336';
                    notification.style.color = 'white';
                    break;
                case 'warning':
                    notification.style.backgroundColor = '#ff9800';
                    notification.style.color = 'white';
                    break;
                default:
                    notification.style.backgroundColor = '#2196F3';
                    notification.style.color = 'white';
            }
            
            document.body.appendChild(notification);
            
            // Удаляем уведомление через 5 секунд
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.5s ease-out';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 5000);
        }

        // Добавляем стили для анимации
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Обновляем модальное окно для email
        const emailModal = document.createElement('div');
        emailModal.className = 'modal-overlay';
        emailModal.innerHTML = `
            <div class="modal-content" style="max-width: 500px;">
                <button class="modal-close" onclick="closeEmailModal()">&times;</button>
                <div class="email-form">
                    <h3>Оповещение организатора</h3>
                    <div class="form-group">
                        <label for="emailMessage">Сообщение для организатора:</label>
                        <textarea id="emailMessage" class="form-control" rows="6" 
                            placeholder="Введите текст сообщения для организатора"></textarea>
                    </div>
                    <div class="form-actions">
                        <button onclick="notifyOrganizer()" class="btn-primary">ОПОВЕСТИТЬ ОРГАНИЗАТОРА</button>
                        <button onclick="closeEmailModal()" class="btn-secondary">Отмена</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(emailModal);

        function showEmailModal() {
            if (!currentOrganizerData || !currentOrganizerData.email) {
                showNotification('Email организатора недоступен', 'warning');
                return;
            }
            
            const modal = document.querySelector('.modal-overlay');
            modal.style.display = 'flex';
            
            // Очищаем поля формы
            document.getElementById('emailSubject').value = '';
            document.getElementById('emailMessage').value = '';
        }

        function closeEmailModal() {
            const modal = document.querySelector('.modal-overlay');
            modal.style.display = 'none';
        }

        async function sendEmail() {
            if (!currentOrganizerData) return;

            const subject = document.getElementById('emailSubject').value;
            const message = document.getElementById('emailMessage').value;

            if (!subject || !message) {
                showNotification('Пожалуйста, заполните все поля', 'warning');
                return;
            }

            try {
                const accessToken = localStorage.getItem('accessToken');
                const refreshToken = localStorage.getItem('refreshToken');

                const response = await fetch('/PlaceAndPlay/api/private/messages/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'accessToken': accessToken,
                        'refreshToken': refreshToken
                    },
                    body: JSON.stringify({
                        recipientId: currentOrganizerData.userId,
                        subject: subject,
                        message: message
                    })
                });

                if (response.ok) {
                    showNotification('Сообщение отправлено', 'success');
                    closeEmailModal();
                } else {
                    throw new Error('Ошибка при отправке сообщения');
                }
            } catch (error) {
                console.error('Ошибка при отправке сообщения:', error);
                showNotification('Ошибка при отправке сообщения', 'error');
            }
        }

        function showPhoneNumber() {
            if (!currentOrganizerData) {
                showNotification('Данные организатора недоступны', 'warning');
                return;
            }

            const phoneNumber = currentOrganizerData.phoneNumber;
            if (!phoneNumber) {
                console.log('Данные организатора:', currentOrganizerData);
                showNotification('Номер телефона организатора недоступен', 'warning');
                return;
            }

            // Создаем модальное окно для отображения номера телефона
            const phoneModal = document.createElement('div');
            phoneModal.className = 'modal-overlay';
            phoneModal.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
                    <div style="padding: 20px; text-align: center;">
                        <h3>Контактный телефон организатора</h3>
                        <p style="font-size: 1.5em; margin: 20px 0; font-weight: bold; color: #007bff;">
                            ${phoneNumber}
                        </p>
                        <button onclick="window.location.href='tel:${phoneNumber}'" 
                                style="background-color: #28a745; color: white; border: none; padding: 12px 24px; 
                                       border-radius: 4px; cursor: pointer; font-size: 1.1em; display: flex; 
                                       align-items: center; gap: 8px; margin: 0 auto;">
                            <i>📞</i> Позвонить
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(phoneModal);
            phoneModal.style.display = 'flex';
        }

        function showStatusChangeMenu(event) {
            event.stopPropagation();
            
            if (!currentEventData || !currentOrganizerData) {
                showNotification('Данные о событии недоступны', 'error');
                return;
            }

            // Создаем подменю для смены статуса
            const statusMenu = document.createElement('div');
            statusMenu.className = 'status-change-menu';
            statusMenu.innerHTML = `
                <div class="status-change-item" onclick="changeEventStatus('CHANGES_REQUESTED')">
                    Требуются изменения
                </div>
                <div class="status-change-item" onclick="changeEventStatus('REJECTED')">
                    Отклонить
                </div>
                <div class="status-change-item" onclick="changeEventStatus('CONFIRMED')">
                    Подтвердить
                </div>
            `;

            // Позиционируем подменю
            const rect = contextMenu.getBoundingClientRect();
            statusMenu.style.left = `${rect.right + 5}px`;
            statusMenu.style.top = `${rect.top}px`;

            // Удаляем предыдущее подменю, если оно есть
            const existingMenu = document.querySelector('.status-change-menu');
            if (existingMenu) {
                existingMenu.remove();
            }

            document.body.appendChild(statusMenu);
            statusMenu.classList.add('active');

            // Закрываем подменю при клике вне его
            const closeStatusMenu = (e) => {
                if (!statusMenu.contains(e.target)) {
                    statusMenu.remove();
                    document.removeEventListener('click', closeStatusMenu);
                }
            };
            setTimeout(() => {
                document.addEventListener('click', closeStatusMenu);
            }, 0);
        }

        // Добавляем стили для контекстного меню и подменю
        const contextMenuStyles = document.createElement('style');
        contextMenuStyles.textContent = `
            .context-menu {
                position: fixed;
                background: white;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
                padding: 8px 0;
                min-width: 200px;
                z-index: 1000;
                opacity: 0;
                transform: scale(0.95);
                transition: opacity 0.1s, transform 0.1s;
                visibility: hidden;
            }

            .context-menu.active {
                opacity: 1;
                transform: scale(1);
                visibility: visible;
            }

            .context-menu-item {
                padding: 8px 16px;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 8px;
                color: #333;
                transition: background-color 0.2s;
            }

            .context-menu-item:hover {
                background-color: #f8f9fa;
            }

            .context-menu-separator {
                height: 1px;
                background-color: #dee2e6;
                margin: 4px 0;
            }

            .context-menu-icon {
                font-size: 1.1em;
                width: 20px;
                text-align: center;
            }

            .status-change-menu {
                position: fixed;
                background: white;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
                z-index: 1001;
                min-width: 200px;
            }

            .status-change-item {
                padding: 8px 16px;
                cursor: pointer;
                transition: background-color 0.2s;
            }

            .status-change-item:hover {
                background-color: #f8f9fa;
            }
        `;
        document.head.appendChild(contextMenuStyles);

        // Новая или модифицированная функция для показа выпадающего списка смены статуса
        function showStatusChangeDropdown(eventData, buttonElement) {
            console.log('[StatusDropdown] Opening dropdown for event:', eventData);
            console.log('[StatusDropdown] Current status:', eventData.status);

            // Удаляем существующее меню, если оно есть
            const existingDropdown = document.querySelector('.status-change-dropdown');
            if (existingDropdown) {
                existingDropdown.remove();
            }

            const dropdown = document.createElement('div');
            dropdown.className = 'status-change-dropdown';

            let dropdownItems = '';

            // Определяем доступные опции смены статуса в зависимости от текущего статуса события
            switch(eventData.status) {
                case 'PENDING_APPROVAL':
                    dropdownItems = `
                        <div class="status-change-dropdown-item" onclick="changeEventStatus('CONFIRMED')">
                            <i>✅</i>
                            Подтвердить
                        </div>
                        <div class="status-change-dropdown-item" onclick="changeEventStatus('CHANGES_REQUESTED')">
                            <i>🔄</i>
                            Требуются изменения
                        </div>
                        <div class="status-change-dropdown-separator"></div>
                        <div class="status-change-dropdown-item danger" onclick="changeEventStatus('REJECTED')">
                            <i>❌</i>
                            Отклонить
                        </div>
                    `;
                    break;
                case 'CONFIRMED':
                    dropdownItems = `
                        <div class="status-change-dropdown-item" onclick="changeEventStatus('IN_PROGRESS')">
                            <i>🚀</i>
                            Начать событие
                        </div>
                    `;
                    break;
                case 'IN_PROGRESS':
                    dropdownItems = `
                        <div class="status-change-dropdown-item" onclick="changeEventStatus('COMPLETED')">
                            <i>✅</i>
                            Завершить
                        </div>
                    `;
                    break;
                case 'REJECTED':
                    // Нет доступных опций для смены статуса
                    dropdownItems = '';
                    break;
                default:
                    // Для других статусов нет опций смены статуса в этом меню
                    dropdownItems = '';
            }

            // Если нет доступных пунктов меню, не показываем его
            if (!dropdownItems.trim()) {
                console.log('[StatusDropdown] No available status changes for current status');
                return;
            }

            dropdown.innerHTML = dropdownItems;

            // Добавляем стили для выпадающего списка
            const dropdownStyles = document.createElement('style');
            dropdownStyles.textContent = `
                .status-change-dropdown {
                    position: absolute;
                    background: white;
                    border-radius: 8px;
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
                    z-index: 1001;
                    opacity: 0;
                    transform: translateY(-10px);
                    transition: opacity 0.2s, transform 0.2s;
                }

                .status-change-dropdown.active {
                    opacity: 1;
                    transform: translateY(0);
                }

                .status-change-dropdown-item {
                    padding: 10px 15px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    transition: background-color 0.2s;
                }

                .status-change-dropdown-item:hover {
                    background-color: #f8f9fa;
                }

                .status-change-dropdown-item.danger {
                    color: #dc3545;
                }

                .status-change-dropdown-item.danger:hover {
                    background-color: #fff5f5;
                }

                .status-change-dropdown-separator {
                    height: 1px;
                    background-color: #dee2e6;
                    margin: 4px 0;
                }
            `;
            document.head.appendChild(dropdownStyles);

            // Позиционируем выпадающий список
            const rect = buttonElement.getBoundingClientRect();
            dropdown.style.position = 'fixed';
            dropdown.style.top = `${rect.bottom + 5}px`;
            dropdown.style.left = `${rect.left}px`;
            dropdown.style.minWidth = `${rect.width}px`;

            document.body.appendChild(dropdown);

            // Активируем меню после добавления в DOM
            requestAnimationFrame(() => {
                dropdown.classList.add('active');
            });

            // Закрываем меню при клике вне его
            const closeDropdown = (e) => {
                if (!dropdown.contains(e.target) && e.target !== buttonElement) {
                    dropdown.remove();
                    document.removeEventListener('click', closeDropdown);
                }
            };

            // Добавляем обработчик с небольшой задержкой, чтобы не сработал сразу
            setTimeout(() => {
                document.addEventListener('click', closeDropdown);
            }, 0);

            // Закрываем меню при прокрутке
            const closeOnScroll = () => {
                if (dropdown.classList.contains('active')) {
                    dropdown.remove();
                    document.removeEventListener('scroll', closeOnScroll);
                }
            };
            document.addEventListener('scroll', closeOnScroll);
        }

        async function showContactOptions(eventId) {
            const accessToken = localStorage.getItem('accessToken');
            const refreshToken = localStorage.getItem('refreshToken');
            
            const response = await fetch(`/PlaceAndPlay/api/v1/events/${eventId}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'accessToken': accessToken,
                    'refreshToken': refreshToken,
                    'language': 'ru'
                }
            });
            
            const event = await response.json();
            return event.organizer.phoneNumber;
        }

        async function contactOrganizer(eventId) {
            const eventItem = document.querySelector(`[data-event-id="${eventId}"]`);
            const eventData = JSON.parse(eventItem.dataset.eventData);
            const phoneNumber = eventData.organizer.phoneNumber;
            const email = eventData.organizer.email;

            // Создаем модальное окно
            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.innerHTML = `
                <div class="modal-content" style="max-width: 400px; text-align: center; padding: 30px;">
                    <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" 
                            style="position: absolute; right: 15px; top: 15px; background: none; border: none; 
                                   font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 24px; color: #113366; margin-bottom: 10px;">
                            <i style="font-size: 32px;">📞</i>
                        </div>
                        <h3 style="color: #113366; margin: 0 0 20px 0;">Номер телефона организатора</h3>
                        <div style="font-size: 28px; font-weight: bold; color: #28a745; 
                               padding: 15px; background: #f8f9fa; border-radius: 10px; 
                               margin: 20px 0; letter-spacing: 1px;">
                            ${phoneNumber}
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <button onclick="window.location.href='tel:${phoneNumber}'" 
                                style="background: #28a745; color: white; border: none; padding: 12px 30px; 
                                       border-radius: 8px; font-size: 16px; cursor: pointer; 
                                       display: inline-flex; align-items: center; justify-content: center; gap: 8px; 
                                       transition: background-color 0.2s;">
                            <i style="font-size: 20px;">📞</i>
                            Позвонить
                        </button>
                        
                        <button onclick="window.location.href='mailto:${email}'" 
                                style="background: #f8f9fa; color: #6c757d; border: 1px solid #dee2e6; 
                                       padding: 10px 30px; border-radius: 8px; font-size: 14px; 
                                       cursor: pointer; display: inline-flex; align-items: center; 
                                       justify-content: center; gap: 8px; transition: all 0.2s;">
                            <i style="font-size: 16px;">📧</i>
                            Связаться по Email
                        </button>
                    </div>
                </div>
            `;

            // Добавляем стили для анимации и эффектов
            const style = document.createElement('style');
            style.textContent = `
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                    animation: fadeIn 0.3s ease-out;
                }

                .modal-content {
                    background: white;
                    border-radius: 15px;
                    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
                    animation: slideIn 0.3s ease-out;
                }

                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }

                @keyframes slideIn {
                    from {
                        opacity: 0;
                        transform: translateY(-20px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                .modal-close:hover {
                    color: #333;
                }

                button:hover {
                    transform: translateY(-1px);
                }

                button:first-child:hover {
                    background-color: #218838 !important;
                }

                button:last-child:hover {
                    background-color: #e9ecef !important;
                    border-color: #ced4da !important;
                    color: #495057 !important;
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(modalOverlay);

            // Закрытие по клику вне модального окна
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    modalOverlay.remove();
                }
            });

            // Закрытие по Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    modalOverlay.remove();
                }
            });
        }
    </script>
</body>
</html>